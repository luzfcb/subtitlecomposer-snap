sudo: required
language: python
services:
  - docker
env:
  global:
  - DOCKER_COMPOSE_VERSION: 1.11.2
  - COMMIT=${TRAVIS_COMMIT::8}
  - IMAGE_NAME=subtitlecomposer_builder
  - REPO=luzfcb/subtitlecomposer_builder

before_install:
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update -qq
  - sudo apt-get install -qq docker-ce libnetfilter-queue-dev libpcap-dev iptables-dev
  - sudo rm /usr/local/bin/docker-compose
  - sudo -H pip install "docker-compose==$DOCKER_COMPOSE_VERSION"
script:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then 
    export TAG="latest"; else export TAG="$TRAVIS_BRANCH"; 
    fi
  - scripts/up
  

#after_success:
  #- if [ "$TRAVIS_BRANCH" == "master" ]; then
    #docker login -u $DOCKER_USER -p $DOCKER_PASS ;
    #docker tag $REPO:$COMMIT $REPO:$TAG ;
    #docker tag $REPO:$COMMIT $REPO:$TRAVIS_BUILD_NUMBER  ;
    #docker push $REPO ;
    #fi
  #- echo "Done"
